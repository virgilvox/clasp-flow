import{i as fe,d as qe,u as Ue,j as Le,k as Fe,m as Re,r as C,n as $,w as Ee,p as ze,q as Pe,s as Ye,a as v,b as s,v as F,x as _,f as q,y,g as de,z as W,S as Ae,A as O,F as Z,B as Ne,C as Oe,D as De,T as Te,E as Ie,o as c,G as H,H as D,Z as Xe,I as Be,_ as $e}from"./index-vP_lUcUF.js";import{R as V,E as We,a as He,W as Ke,P as Ge}from"./WaveformEditor-CuUG1E1e.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=fe("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=fe("LayoutGridIcon",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Qe={class:"control-panel-view"},Je={class:"control-panel-header"},et={class:"header-left"},tt={key:0,class:"running-indicator"},at={class:"header-right"},ot=["onMousedown"],lt=["onMousedown"],nt=["value","onInput"],it={key:1},st={key:0,class:"fader-container"},ut=["onMousedown"],rt={class:"fader-value"},ct=["onMousedown","onMouseup","onMouseleave"],dt=["onMousedown"],vt={class:"xy-values"},ft=["value","onInput"],mt={key:5,class:"lfo-controls"},pt={key:9,class:"monitor-display"},ht=["width","height"],gt=["width","height"],yt={key:13,class:"synth-control"},xt={class:"synth-instrument"},wt=["value","onChange"],bt={class:"synth-knobs"},kt={key:1,class:"live-value"},Mt=["onMousedown"],_t={key:0,class:"empty-state"},Vt={class:"control-panel-footer"},St={class:"playback-controls"},Ct={class:"fps-display"},qt={class:"flow-info"},f=60,ve=128,Ut=qe({__name:"ControlPanelView",setup(Lt){const P=Ue(),b=Le(),me=Fe(),x=Re(),T=C(null),K=C(1200),I=$(()=>Math.max(6,Math.floor(K.value/f))),pe=["slider","knob","trigger","xy-pad","constant","lfo","envelope-visual","parametric-eq","wavetable","keyboard","synth"],Q=["monitor","oscilloscope","main-output"],g=C(!1),p=C(null),S=C(null),R=C(null),he={slider:"#00d4aa",knob:"#ff6b35","xy-pad":"#a855f7",trigger:"#ef4444",monitor:"#22c55e",oscilloscope:"#3b82f6",constant:"#888888",lfo:"#f59e0b","envelope-visual":"#ff6b35","parametric-eq":"#a855f7",wavetable:"#22c55e",keyboard:"#22c55e",synth:"#f59e0b","main-output":"#3b82f6"},E=$(()=>b.activeFlow?b.activeFlow.nodes.filter(l=>{var o;const t=(o=l.data)==null?void 0:o.nodeType;return pe.includes(t)||Q.includes(t)}).map(l=>{var u,n;const t=(u=l.data)==null?void 0:u.nodeType,o=me.getDefinition(t),e=P.getControlLayout(l.id,t);return{node:l,nodeType:t,definition:o,label:((n=l.data)==null?void 0:n.label)||(o==null?void 0:o.name)||t,layout:e,isMonitor:Q.includes(t),accentColor:he[t]||"#00d4aa"}}):[]),ge=$(()=>{if(E.value.length===0)return 400;const l=Math.max(...E.value.map(t=>t.layout.y+t.layout.h));return Math.max(400,(l+2)*f)});function i(l,t,o=0){var u;const e=(u=b.activeFlow)==null?void 0:u.nodes.find(n=>n.id===l);return e!=null&&e.data?e.data[t]??o:o}function r(l,t,o){b.updateNodeData(l,{[t]:o})}function ye(l){const t=x.nodeMetrics.get(l);if(!(t!=null&&t.outputValues))return"";const o=t.outputValues.value??t.outputValues.result??t.outputValues.trigger;return o==null?"":typeof o=="number"?o.toFixed(3):typeof o=="boolean"?o?"1":"0":String(o)}function xe(l){const t=x.nodeMetrics.get(l);if(!(t!=null&&t.outputValues))return"—";const o=t.outputValues.display??t.outputValues.value;return o==null?"—":typeof o=="number"?o.toFixed(4):typeof o=="boolean"?o?"TRUE":"FALSE":String(o)}function we(l,t){b.updateNodeData(l,{label:t})}function J(l,t,o){g.value&&(l.preventDefault(),l.stopPropagation(),p.value={nodeId:t,startX:o.x,startY:o.y,offsetX:l.clientX,offsetY:l.clientY,currentX:o.x,currentY:o.y})}function ee(l){if(p.value){const t=Math.round((l.clientX-p.value.offsetX)/f),o=Math.round((l.clientY-p.value.offsetY)/f);p.value.currentX=Math.max(0,Math.min(I.value-1,p.value.startX+t)),p.value.currentY=Math.max(0,p.value.startY+o)}if(S.value){const t=Math.round((l.clientX-S.value.startX)/f),o=Math.round((l.clientY-S.value.startY)/f),e=Math.max(2,Math.min(I.value,S.value.startW+t)),u=Math.max(2,S.value.startH+o);P.updateControlLayout(S.value.nodeId,{w:e,h:u})}if(R.value){const t=R.value.startY-l.clientY,o=1/150;let e=R.value.startValue+t*o;e=Math.max(0,Math.min(1,e)),r(R.value.nodeId,"value",e)}}function te(){p.value&&(P.updateControlLayout(p.value.nodeId,{x:p.value.currentX,y:p.value.currentY}),p.value=null),S.value=null,R.value=null}function be(l,t,o){g.value&&(l.preventDefault(),l.stopPropagation(),S.value={nodeId:t,startW:o.w,startH:o.h,startX:l.clientX,startY:l.clientY})}function ke(l,t){if(g.value)return;l.preventDefault(),l.stopPropagation();const o=i(t,"value",.5);R.value={nodeId:t,startY:l.clientY,startValue:o}}function ae(l,t){var o;return((o=p.value)==null?void 0:o.nodeId)===l?{x:p.value.currentX,y:p.value.currentY}:{x:t.x,y:t.y}}function oe(){P.setViewMode("editor")}const G=$(()=>x.isRunning),j=C(new Map),X=C(new Map);let z=null;function Me(l,t){t?(j.value.set(l,t),X.value.has(l)||X.value.set(l,[])):j.value.delete(l)}function le(){var l,t,o;for(const[e,u]of j.value){const n=u.getContext("2d");if(!n)continue;const d=u.width,k=u.height;n.fillStyle="#0a0a0a",n.fillRect(0,0,d,k),n.strokeStyle="#1a3a1a",n.lineWidth=1,n.beginPath(),n.moveTo(0,k/2),n.lineTo(d,k/2),n.stroke();for(let m=0;m<8;m++){const w=d/8*m;n.beginPath(),n.moveTo(w,0),n.lineTo(w,k),n.stroke()}const h=x.nodeMetrics.get(e),B=((l=h==null?void 0:h.outputValues)==null?void 0:l._mode)??"signal",L=(t=h==null?void 0:h.outputValues)==null?void 0:t._input_waveform,a=((o=h==null?void 0:h.outputValues)==null?void 0:o._input_signal)??0;if(B==="audio"&&L&&L.length>0){n.strokeStyle="#3b82f6",n.lineWidth=2,n.beginPath();const m=d/L.length;for(let w=0;w<L.length;w++){const M=w*m,N=k/2-L[w]*(k/2-4);w===0?n.moveTo(M,N):n.lineTo(M,N)}n.stroke(),n.shadowColor="#3b82f6",n.shadowBlur=4,n.stroke(),n.shadowBlur=0,n.fillStyle="#3b82f6",n.font="10px monospace",n.fillText("AUDIO",4,12)}else{let m=X.value.get(e)??[];if(m.push(a),m.length>ve&&m.shift(),X.value.set(e,m),m.length>1){n.strokeStyle="#3b82f6",n.lineWidth=2,n.beginPath();const w=d/ve;for(let M=0;M<m.length;M++){const N=M*w,ce=k/2-m[M]*(k/2-4);M===0?n.moveTo(N,ce):n.lineTo(N,ce)}n.stroke(),n.shadowColor="#3b82f6",n.shadowBlur=4,n.stroke(),n.shadowBlur=0}n.fillStyle="#3b82f6",n.font="10px monospace",n.fillText(`${a.toFixed(3)}`,4,12)}}x.isRunning&&(z=requestAnimationFrame(le))}function ne(){z===null&&x.isRunning&&(z=requestAnimationFrame(le))}function ie(){z!==null&&(cancelAnimationFrame(z),z=null)}const Y=C(new Map);let U=null;function _e(l,t){t?Y.value.set(l,t):Y.value.delete(l)}function se(){if(Y.value.size===0){U=null;return}for(const[l,t]of Y.value){const o=t.getContext("2d");if(o)try{const u=De().getNodeTexture(l);if(!u||!(u instanceof Te)){o.fillStyle="#1a1a1a",o.fillRect(0,0,t.width,t.height),o.fillStyle="#666",o.font="12px monospace",o.textAlign="center",o.fillText("No Input",t.width/2,t.height/2);continue}Ie().renderToCanvas(u,t)}catch{o.fillStyle="#1a1a1a",o.fillRect(0,0,t.width,t.height)}}x.isRunning?U=requestAnimationFrame(se):U=null}function ue(){U===null&&x.isRunning&&Y.value.size>0&&(U=requestAnimationFrame(se))}function re(){U!==null&&(cancelAnimationFrame(U),U=null)}Ee(()=>x.isRunning,l=>{l?(ne(),ue()):(ie(),re())});function Ve(l,t,o){b.updateNodeData(l,{note:t,velocity:o,gate:!0,noteOn:!0}),setTimeout(()=>{b.updateNodeData(l,{noteOn:!1})},50)}function Se(l,t){var e,u;const o=(e=b.activeFlow)==null?void 0:e.nodes.find(n=>n.id===l);((u=o==null?void 0:o.data)==null?void 0:u.note)===t&&b.updateNodeData(l,{gate:!1})}function Ce(){const l=E.value.map(t=>({id:t.node.id,nodeType:t.nodeType}));P.autoLayoutAll(l,I.value)}let A=null;return ze(()=>{window.addEventListener("mousemove",ee),window.addEventListener("mouseup",te),x.isRunning&&Pe(()=>{ne(),ue()}),T.value&&(K.value=T.value.clientWidth-32,A=new ResizeObserver(l=>{for(const t of l)K.value=t.contentRect.width-32}),A.observe(T.value))}),Ye(()=>{window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",te),ie(),re(),A==null||A.disconnect()}),(l,t)=>{var o;return c(),v("div",Qe,[s("header",Je,[s("div",et,[s("h1",null,_(((o=q(b).activeFlow)==null?void 0:o.name)??"Control Panel"),1),G.value?(c(),v("span",tt,"LIVE")):F("",!0)]),s("div",at,[g.value?(c(),v("button",{key:0,class:"auto-layout-btn",title:"Auto-arrange all controls",onClick:Ce},[y(q(Ze),{size:16}),t[6]||(t[6]=de(" Auto Layout ",-1))])):F("",!0),s("button",{class:W(["edit-mode-btn",{active:g.value}]),onClick:t[0]||(t[0]=e=>g.value=!g.value)},[y(q(Ae),{size:16}),de(" "+_(g.value?"Done":"Edit Layout"),1)],2),s("button",{class:"back-btn",onClick:oe}," Back to Editor ")])]),s("main",{ref_key:"containerRef",ref:T,class:W(["control-panel-content",{"edit-mode":g.value}])},[s("div",{class:"control-grid",style:O({"--grid-cols":I.value,"--cell-size":f+"px",minHeight:ge.value+"px"})},[t[9]||(t[9]=s("div",{class:"grid-dots"},null,-1)),(c(!0),v(Z,null,Ne(E.value,({node:e,nodeType:u,label:n,layout:d,isMonitor:k,accentColor:h})=>{var B,L;return c(),v("div",{key:e.id,class:W(["control-item",[u,{dragging:((B=p.value)==null?void 0:B.nodeId)===e.id,resizing:((L=S.value)==null?void 0:L.nodeId)===e.id,"edit-mode-item":g.value}]]),style:O({left:ae(e.id,d).x*f+"px",top:ae(e.id,d).y*f+"px",width:d.w*f-16+"px",height:d.h*f-16+"px","--accent-color":h}),onMousedown:a=>g.value?J(a,e.id,d):void 0},[g.value?(c(),v("div",{key:0,class:"edit-overlay",onMousedown:a=>J(a,e.id,d)},[y(q(je),{size:20}),t[7]||(t[7]=s("span",{class:"edit-hint"},"Drag to move",-1))],40,lt)):F("",!0),s("div",{class:"control-label",onMousedown:t[2]||(t[2]=H(()=>{},["stop"]))},[g.value?(c(),v("input",{key:0,type:"text",class:"label-input",value:n,onInput:a=>we(e.id,a.target.value),onMousedown:t[1]||(t[1]=H(()=>{},["stop"]))},null,40,nt)):(c(),v("span",it,_(n),1))],32),s("div",{class:"control-widget",onMousedown:t[3]||(t[3]=H(()=>{},["stop"]))},[u==="slider"?(c(),v("div",st,[s("div",{class:"fader-track",onMousedown:a=>ke(a,e.id)},[s("div",{class:"fader-fill",style:O({height:`${i(e.id,"value",.5)*100}%`})},null,4),s("div",{class:"fader-thumb",style:O({bottom:`${i(e.id,"value",.5)*100}%`})},null,4)],40,ut),s("div",rt,_(i(e.id,"value",.5).toFixed(2)),1)])):u==="knob"?(c(),D(V,{key:1,"model-value":i(e.id,"value",.5),min:i(e.id,"min",0),max:i(e.id,"max",1),step:.01,"accent-color":h,size:"large","onUpdate:modelValue":a=>r(e.id,"value",a)},null,8,["model-value","min","max","accent-color","onUpdate:modelValue"])):u==="trigger"?(c(),v("button",{key:2,class:W(["trigger-btn",{active:i(e.id,"value",!1)}]),onMousedown:a=>r(e.id,"value",!0),onMouseup:a=>r(e.id,"value",!1),onMouseleave:a=>r(e.id,"value",!1)},[y(q(Xe),{size:24})],42,ct)):u==="xy-pad"?(c(),v(Z,{key:3},[s("div",{class:"xy-pad",onMousedown:a=>{const m=a.currentTarget.getBoundingClientRect(),w=Math.max(0,Math.min(1,(a.clientX-m.left)/m.width)),M=Math.max(0,Math.min(1,1-(a.clientY-m.top)/m.height));r(e.id,"x",w),r(e.id,"y",M)}},[s("div",{class:"xy-cursor",style:O({left:`${i(e.id,"x",.5)*100}%`,bottom:`${i(e.id,"y",.5)*100}%`})},null,4)],40,dt),s("div",vt,[s("span",null,"X: "+_(i(e.id,"x",.5).toFixed(2)),1),s("span",null,"Y: "+_(i(e.id,"y",.5).toFixed(2)),1)])],64)):u==="constant"?(c(),v("input",{key:4,type:"number",class:"constant-input",value:i(e.id,"value",0),step:"0.1",onInput:a=>r(e.id,"value",parseFloat(a.target.value)||0)},null,40,ft)):u==="lfo"?(c(),v("div",mt,[y(V,{"model-value":i(e.id,"frequency",1),min:.01,max:10,step:.01,label:"FREQ","accent-color":h,size:"small","value-format":a=>a.toFixed(1)+"Hz","onUpdate:modelValue":a=>r(e.id,"frequency",a)},null,8,["model-value","accent-color","value-format","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"amplitude",1),min:0,max:2,step:.01,label:"AMP","accent-color":h,size:"small","onUpdate:modelValue":a=>r(e.id,"amplitude",a)},null,8,["model-value","accent-color","onUpdate:modelValue"])])):u==="envelope-visual"?(c(),D(We,{key:6,"model-value":{attack:i(e.id,"attack",.01),decay:i(e.id,"decay",.1),sustain:i(e.id,"sustain",.5),release:i(e.id,"release",.3)},"accent-color":h,width:Math.max(120,d.w*f-32),height:Math.max(60,d.h*f-64),"onUpdate:modelValue":a=>{r(e.id,"attack",a.attack),r(e.id,"decay",a.decay),r(e.id,"sustain",a.sustain),r(e.id,"release",a.release)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):u==="parametric-eq"?(c(),D(He,{key:7,"model-value":{bands:[{frequency:i(e.id,"freq1",200),gain:i(e.id,"gain1",0),q:i(e.id,"q1",1)},{frequency:i(e.id,"freq2",1e3),gain:i(e.id,"gain2",0),q:i(e.id,"q2",1)},{frequency:i(e.id,"freq3",5e3),gain:i(e.id,"gain3",0),q:i(e.id,"q3",1)}]},"accent-color":h,width:Math.max(160,d.w*f-32),height:Math.max(80,d.h*f-48),"onUpdate:modelValue":a=>{r(e.id,"freq1",a.bands[0].frequency),r(e.id,"gain1",a.bands[0].gain),r(e.id,"q1",a.bands[0].q),r(e.id,"freq2",a.bands[1].frequency),r(e.id,"gain2",a.bands[1].gain),r(e.id,"q2",a.bands[1].q),r(e.id,"freq3",a.bands[2].frequency),r(e.id,"gain3",a.bands[2].gain),r(e.id,"q3",a.bands[2].q)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):u==="wavetable"?(c(),D(Ke,{key:8,"model-value":{samples:i(e.id,"waveform",[]).length>0?i(e.id,"waveform",[]):Array.from({length:64},(a,m)=>Math.sin(m/64*Math.PI*2)),preset:i(e.id,"preset","sine")},"accent-color":h,width:Math.max(120,d.w*f-32),height:Math.max(60,d.h*f-48),"onUpdate:modelValue":a=>{r(e.id,"waveform",a.samples),r(e.id,"preset",a.preset)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):u==="monitor"?(c(),v("div",pt,_(xe(e.id)),1)):u==="oscilloscope"?(c(),v("canvas",{key:10,ref_for:!0,ref:a=>Me(e.id,a),class:"scope-canvas",width:Math.max(100,d.w*f-32),height:Math.max(60,d.h*f-48)},null,8,ht)):u==="main-output"?(c(),v("canvas",{key:11,ref_for:!0,ref:a=>_e(e.id,a),class:"output-canvas",width:Math.max(160,d.w*f-32),height:Math.max(100,d.h*f-48)},null,8,gt)):u==="keyboard"?(c(),D(Ge,{key:12,"num-keys":parseInt(i(e.id,"numKeys","25")),"start-octave":i(e.id,"startOctave",3),"octave-shift":i(e.id,"octaveShift",0),"include-black-keys":i(e.id,"includeBlackKeys",!0),"velocity-sensitive":i(e.id,"velocitySensitive",!0),width:Math.max(200,d.w*f-32),height:Math.max(80,d.h*f-48),"dark-mode":"",onNoteOn:(a,m)=>Ve(e.id,a,m),onNoteOff:a=>Se(e.id,a)},null,8,["num-keys","start-octave","octave-shift","include-black-keys","velocity-sensitive","width","height","onNoteOn","onNoteOff"])):u==="synth"?(c(),v("div",yt,[s("div",xt,[s("select",{value:i(e.id,"instrument","sine"),onChange:a=>r(e.id,"instrument",a.target.value)},[...t[8]||(t[8]=[Be('<option value="sine" data-v-cc6ddcf2> Sine </option><option value="moog" data-v-cc6ddcf2> Moog Bass </option><option value="piano" data-v-cc6ddcf2> Piano </option><option value="organ" data-v-cc6ddcf2> Organ </option><option value="pluck" data-v-cc6ddcf2> Pluck </option><option value="pad" data-v-cc6ddcf2> Pad </option>',6)])],40,wt)]),s("div",bt,[y(V,{"model-value":i(e.id,"volume",-6),min:-60,max:0,label:"VOL",size:"small","accent-color":"#f59e0b","onUpdate:modelValue":a=>r(e.id,"volume",a)},null,8,["model-value","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"attack",.01),min:.001,max:2,label:"ATK",size:"small","accent-color":"#f59e0b","onUpdate:modelValue":a=>r(e.id,"attack",a)},null,8,["model-value","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"decay",.1),min:.001,max:2,label:"DEC",size:"small","accent-color":"#f59e0b","onUpdate:modelValue":a=>r(e.id,"decay",a)},null,8,["model-value","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"sustain",.7),min:0,max:1,label:"SUS",size:"small","accent-color":"#f59e0b","onUpdate:modelValue":a=>r(e.id,"sustain",a)},null,8,["model-value","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"release",.3),min:.001,max:5,label:"REL",size:"small","accent-color":"#f59e0b","onUpdate:modelValue":a=>r(e.id,"release",a)},null,8,["model-value","onUpdate:modelValue"]),i(e.id,"instrument","sine")==="moog"?(c(),v(Z,{key:0},[y(V,{"model-value":i(e.id,"filterCutoff",2e3),min:20,max:2e4,label:"CUT",size:"small","accent-color":"#ec4899","onUpdate:modelValue":a=>r(e.id,"filterCutoff",a)},null,8,["model-value","onUpdate:modelValue"]),y(V,{"model-value":i(e.id,"filterResonance",1),min:.1,max:20,label:"RES",size:"small","accent-color":"#ec4899","onUpdate:modelValue":a=>r(e.id,"filterResonance",a)},null,8,["model-value","onUpdate:modelValue"])],64)):F("",!0)])])):F("",!0)],32),G.value&&!k&&u!=="slider"?(c(),v("div",kt,_(ye(e.id)),1)):F("",!0),g.value?(c(),v("div",{key:2,class:"resize-handle",onMousedown:H(a=>be(a,e.id,d),["stop"])},null,40,Mt)):F("",!0)],46,ot)}),128))],4),E.value.length===0?(c(),v("div",_t,[y(q(Oe),{size:48,class:"empty-icon"}),t[10]||(t[10]=s("h2",null,"No Controls in Flow",-1)),t[11]||(t[11]=s("p",null,"Add control nodes to your flow:",-1)),t[12]||(t[12]=s("ul",null,[s("li",null,"Slider, Knob, Trigger, XY Pad"),s("li",null,"Constant, LFO"),s("li",null,"Monitor, Oscilloscope")],-1)),s("button",{class:"back-btn",onClick:oe}," Go to Editor ")])):F("",!0)],2),s("footer",Vt,[s("div",St,[G.value?(c(),v("button",{key:1,class:"stop-btn",onClick:t[5]||(t[5]=e=>q(x).stop())}," STOP ")):(c(),v("button",{key:0,class:"play-btn",onClick:t[4]||(t[4]=e=>q(x).start())}," PLAY ")),s("span",Ct,_(q(x).fps)+" FPS",1)]),s("div",qt,[s("span",null,_(E.value.length)+" controls",1)])])])}}}),Et=$e(Ut,[["__scopeId","data-v-cc6ddcf2"]]);export{Et as default};
