import{c as ge,d as ye,ar as we,a1 as xe,Z as Me,Y as be,r as V,k as A,w as ke,A as _e,G as Ve,s as Se,a as f,b as s,f as C,K as b,j as S,p as N,t as E,V as qe,at as Fe,n as X,F as le,E as Ye,au as Ce,o as c,a5 as $,h as T,a4 as Ee,$ as Le}from"./index-D7aCSx4k.js";import{R as j,E as Pe,a as Re,W as Xe}from"./WaveformEditor-Cf-ivn-W.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=ge("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),ze={class:"control-panel-view"},Ie={class:"control-panel-header"},De={class:"header-left"},Ae={key:0,class:"running-indicator"},Ne={class:"header-right"},$e=["onMousedown"],Te=["onMousedown"],Be=["value","onInput"],We={key:1},He={key:0,class:"fader-container"},Oe=["onMousedown"],je={class:"fader-value"},Ge=["onMousedown","onMouseup","onMouseleave"],Ke=["onMousedown"],Ze={class:"xy-values"},Qe=["value","onInput"],Je={key:5,class:"lfo-controls"},et={key:9,class:"monitor-display"},tt=["width","height"],at={key:1,class:"live-value"},ot=["onMousedown"],nt={key:0,class:"empty-state"},lt={class:"control-panel-footer"},st={class:"playback-controls"},it={class:"fps-display"},ut={class:"flow-info"},p=60,se=128,rt=ye({__name:"ControlPanelView",setup(ct){const U=we(),q=xe(),ie=Me(),w=be(),z=V(null),B=V(1200),W=A(()=>Math.max(6,Math.floor(B.value/p))),ue=["slider","knob","trigger","xy-pad","constant","lfo","envelope-visual","parametric-eq","wavetable"],G=["monitor","oscilloscope","main-output"],g=V(!1),m=V(null),k=V(null),F=V(null),re={slider:"#00d4aa",knob:"#ff6b35","xy-pad":"#a855f7",trigger:"#ef4444",monitor:"#22c55e",oscilloscope:"#3b82f6",constant:"#888888",lfo:"#f59e0b","envelope-visual":"#ff6b35","parametric-eq":"#a855f7",wavetable:"#22c55e"},L=A(()=>q.activeFlow?q.activeFlow.nodes.filter(a=>{var o;const t=(o=a.data)==null?void 0:o.nodeType;return ue.includes(t)||G.includes(t)}).map(a=>{var r,l;const t=(r=a.data)==null?void 0:r.nodeType,o=ie.getDefinition(t),e=U.getControlLayout(a.id);return{node:a,nodeType:t,definition:o,label:((l=a.data)==null?void 0:l.label)||(o==null?void 0:o.name)||t,layout:e,isMonitor:G.includes(t),accentColor:re[t]||"#00d4aa"}}):[]),ce=A(()=>{if(L.value.length===0)return 400;const a=Math.max(...L.value.map(t=>t.layout.y+t.layout.h));return Math.max(400,(a+2)*p)});function i(a,t,o=0){var r;const e=(r=q.activeFlow)==null?void 0:r.nodes.find(l=>l.id===a);return e!=null&&e.data?e.data[t]??o:o}function u(a,t,o){q.updateNodeData(a,{[t]:o})}function de(a){const t=w.nodeMetrics.get(a);if(!(t!=null&&t.outputValues))return"";const o=t.outputValues.value??t.outputValues.result??t.outputValues.trigger;return o==null?"":typeof o=="number"?o.toFixed(3):typeof o=="boolean"?o?"1":"0":String(o)}function ve(a){const t=w.nodeMetrics.get(a);if(!(t!=null&&t.outputValues))return"—";const o=t.outputValues.display??t.outputValues.value;return o==null?"—":typeof o=="number"?o.toFixed(4):typeof o=="boolean"?o?"TRUE":"FALSE":String(o)}function fe(a,t){q.updateNodeData(a,{label:t})}function K(a,t,o){g.value&&(a.preventDefault(),a.stopPropagation(),m.value={nodeId:t,startX:o.x,startY:o.y,offsetX:a.clientX,offsetY:a.clientY,currentX:o.x,currentY:o.y})}function Z(a){if(m.value){const t=Math.round((a.clientX-m.value.offsetX)/p),o=Math.round((a.clientY-m.value.offsetY)/p);m.value.currentX=Math.max(0,Math.min(W.value-1,m.value.startX+t)),m.value.currentY=Math.max(0,m.value.startY+o)}if(k.value){const t=Math.round((a.clientX-k.value.startX)/p),o=Math.round((a.clientY-k.value.startY)/p),e=Math.max(2,Math.min(W.value,k.value.startW+t)),r=Math.max(2,k.value.startH+o);U.updateControlLayout(k.value.nodeId,{w:e,h:r})}if(F.value){const t=F.value.startY-a.clientY,o=1/150;let e=F.value.startValue+t*o;e=Math.max(0,Math.min(1,e)),u(F.value.nodeId,"value",e)}}function Q(){m.value&&(U.updateControlLayout(m.value.nodeId,{x:m.value.currentX,y:m.value.currentY}),m.value=null),k.value=null,F.value=null}function pe(a,t,o){g.value&&(a.preventDefault(),a.stopPropagation(),k.value={nodeId:t,startW:o.w,startH:o.h,startX:a.clientX,startY:a.clientY})}function me(a,t){if(g.value)return;a.preventDefault(),a.stopPropagation();const o=i(t,"value",.5);F.value={nodeId:t,startY:a.clientY,startValue:o}}function J(a,t){var o;return((o=m.value)==null?void 0:o.nodeId)===a?{x:m.value.currentX,y:m.value.currentY}:{x:t.x,y:t.y}}function ee(){U.setViewMode("editor")}const H=A(()=>w.isRunning),O=V(new Map),I=V(new Map);let Y=null;function he(a,t){t?(O.value.set(a,t),I.value.has(a)||I.value.set(a,[])):O.value.delete(a)}function te(){var a,t,o;for(const[e,r]of O.value){const l=r.getContext("2d");if(!l)continue;const d=r.width,x=r.height;l.fillStyle="#0a0a0a",l.fillRect(0,0,d,x),l.strokeStyle="#1a3a1a",l.lineWidth=1,l.beginPath(),l.moveTo(0,x/2),l.lineTo(d,x/2),l.stroke();for(let v=0;v<8;v++){const y=d/8*v;l.beginPath(),l.moveTo(y,0),l.lineTo(y,x),l.stroke()}const h=w.nodeMetrics.get(e),D=((a=h==null?void 0:h.outputValues)==null?void 0:a._mode)??"signal",_=(t=h==null?void 0:h.outputValues)==null?void 0:t._input_waveform,n=((o=h==null?void 0:h.outputValues)==null?void 0:o._input_signal)??0;if(D==="audio"&&_&&_.length>0){l.strokeStyle="#3b82f6",l.lineWidth=2,l.beginPath();const v=d/_.length;for(let y=0;y<_.length;y++){const M=y*v,R=x/2-_[y]*(x/2-4);y===0?l.moveTo(M,R):l.lineTo(M,R)}l.stroke(),l.shadowColor="#3b82f6",l.shadowBlur=4,l.stroke(),l.shadowBlur=0,l.fillStyle="#3b82f6",l.font="10px monospace",l.fillText("AUDIO",4,12)}else{let v=I.value.get(e)??[];if(v.push(n),v.length>se&&v.shift(),I.value.set(e,v),v.length>1){l.strokeStyle="#3b82f6",l.lineWidth=2,l.beginPath();const y=d/se;for(let M=0;M<v.length;M++){const R=M*y,ne=x/2-v[M]*(x/2-4);M===0?l.moveTo(R,ne):l.lineTo(R,ne)}l.stroke(),l.shadowColor="#3b82f6",l.shadowBlur=4,l.stroke(),l.shadowBlur=0}l.fillStyle="#3b82f6",l.font="10px monospace",l.fillText(`${n.toFixed(3)}`,4,12)}}w.isRunning&&(Y=requestAnimationFrame(te))}function ae(){Y===null&&w.isRunning&&(Y=requestAnimationFrame(te))}function oe(){Y!==null&&(cancelAnimationFrame(Y),Y=null)}ke(()=>w.isRunning,a=>{a?ae():oe()},{immediate:!0});let P=null;return _e(()=>{window.addEventListener("mousemove",Z),window.addEventListener("mouseup",Q),w.isRunning&&Ve(()=>ae()),z.value&&(B.value=z.value.clientWidth-32,P=new ResizeObserver(a=>{for(const t of a)B.value=t.contentRect.width-32}),P.observe(z.value))}),Se(()=>{window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",Q),oe(),P==null||P.disconnect()}),(a,t)=>{var o;return c(),f("div",ze,[s("header",Ie,[s("div",De,[s("h1",null,b(((o=S(q).activeFlow)==null?void 0:o.name)??"Control Panel"),1),H.value?(c(),f("span",Ae,"LIVE")):C("",!0)]),s("div",Ne,[s("button",{class:N(["edit-mode-btn",{active:g.value}]),onClick:t[0]||(t[0]=e=>g.value=!g.value)},[E(S(Fe),{size:16}),qe(" "+b(g.value?"Done":"Edit Layout"),1)],2),s("button",{class:"back-btn",onClick:ee}," Back to Editor ")])]),s("main",{ref_key:"containerRef",ref:z,class:N(["control-panel-content",{"edit-mode":g.value}])},[s("div",{class:"control-grid",style:X({"--grid-cols":W.value,"--cell-size":p+"px",minHeight:ce.value+"px"})},[t[7]||(t[7]=s("div",{class:"grid-dots"},null,-1)),(c(!0),f(le,null,Ye(L.value,({node:e,nodeType:r,label:l,layout:d,isMonitor:x,accentColor:h})=>{var D,_;return c(),f("div",{key:e.id,class:N(["control-item",[r,{dragging:((D=m.value)==null?void 0:D.nodeId)===e.id,resizing:((_=k.value)==null?void 0:_.nodeId)===e.id,"edit-mode-item":g.value}]]),style:X({left:J(e.id,d).x*p+"px",top:J(e.id,d).y*p+"px",width:d.w*p-16+"px",height:d.h*p-16+"px","--accent-color":h}),onMousedown:n=>g.value?K(n,e.id,d):void 0},[g.value?(c(),f("div",{key:0,class:"edit-overlay",onMousedown:n=>K(n,e.id,d)},[E(S(Ue),{size:20}),t[6]||(t[6]=s("span",{class:"edit-hint"},"Drag to move",-1))],40,Te)):C("",!0),s("div",{class:"control-label",onMousedown:t[2]||(t[2]=$(()=>{},["stop"]))},[g.value?(c(),f("input",{key:0,type:"text",class:"label-input",value:l,onInput:n=>fe(e.id,n.target.value),onMousedown:t[1]||(t[1]=$(()=>{},["stop"]))},null,40,Be)):(c(),f("span",We,b(l),1))],32),s("div",{class:"control-widget",onMousedown:t[3]||(t[3]=$(()=>{},["stop"]))},[r==="slider"?(c(),f("div",He,[s("div",{class:"fader-track",onMousedown:n=>me(n,e.id)},[s("div",{class:"fader-fill",style:X({height:`${i(e.id,"value",.5)*100}%`})},null,4),s("div",{class:"fader-thumb",style:X({bottom:`${i(e.id,"value",.5)*100}%`})},null,4)],40,Oe),s("div",je,b(i(e.id,"value",.5).toFixed(2)),1)])):r==="knob"?(c(),T(j,{key:1,"model-value":i(e.id,"value",.5),min:i(e.id,"min",0),max:i(e.id,"max",1),step:.01,"accent-color":h,size:"large","onUpdate:modelValue":n=>u(e.id,"value",n)},null,8,["model-value","min","max","accent-color","onUpdate:modelValue"])):r==="trigger"?(c(),f("button",{key:2,class:N(["trigger-btn",{active:i(e.id,"value",!1)}]),onMousedown:n=>u(e.id,"value",!0),onMouseup:n=>u(e.id,"value",!1),onMouseleave:n=>u(e.id,"value",!1)},[E(S(Ee),{size:24})],42,Ge)):r==="xy-pad"?(c(),f(le,{key:3},[s("div",{class:"xy-pad",onMousedown:n=>{const v=n.currentTarget.getBoundingClientRect(),y=Math.max(0,Math.min(1,(n.clientX-v.left)/v.width)),M=Math.max(0,Math.min(1,1-(n.clientY-v.top)/v.height));u(e.id,"x",y),u(e.id,"y",M)}},[s("div",{class:"xy-cursor",style:X({left:`${i(e.id,"x",.5)*100}%`,bottom:`${i(e.id,"y",.5)*100}%`})},null,4)],40,Ke),s("div",Ze,[s("span",null,"X: "+b(i(e.id,"x",.5).toFixed(2)),1),s("span",null,"Y: "+b(i(e.id,"y",.5).toFixed(2)),1)])],64)):r==="constant"?(c(),f("input",{key:4,type:"number",class:"constant-input",value:i(e.id,"value",0),step:"0.1",onInput:n=>u(e.id,"value",parseFloat(n.target.value)||0)},null,40,Qe)):r==="lfo"?(c(),f("div",Je,[E(j,{"model-value":i(e.id,"frequency",1),min:.01,max:10,step:.01,label:"FREQ","accent-color":h,size:"small","value-format":n=>n.toFixed(1)+"Hz","onUpdate:modelValue":n=>u(e.id,"frequency",n)},null,8,["model-value","accent-color","value-format","onUpdate:modelValue"]),E(j,{"model-value":i(e.id,"amplitude",1),min:0,max:2,step:.01,label:"AMP","accent-color":h,size:"small","onUpdate:modelValue":n=>u(e.id,"amplitude",n)},null,8,["model-value","accent-color","onUpdate:modelValue"])])):r==="envelope-visual"?(c(),T(Pe,{key:6,"model-value":{attack:i(e.id,"attack",.01),decay:i(e.id,"decay",.1),sustain:i(e.id,"sustain",.5),release:i(e.id,"release",.3)},"accent-color":h,width:Math.max(120,d.w*p-32),height:Math.max(60,d.h*p-64),"onUpdate:modelValue":n=>{u(e.id,"attack",n.attack),u(e.id,"decay",n.decay),u(e.id,"sustain",n.sustain),u(e.id,"release",n.release)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):r==="parametric-eq"?(c(),T(Re,{key:7,"model-value":{bands:[{frequency:i(e.id,"freq1",200),gain:i(e.id,"gain1",0),q:i(e.id,"q1",1)},{frequency:i(e.id,"freq2",1e3),gain:i(e.id,"gain2",0),q:i(e.id,"q2",1)},{frequency:i(e.id,"freq3",5e3),gain:i(e.id,"gain3",0),q:i(e.id,"q3",1)}]},"accent-color":h,width:Math.max(160,d.w*p-32),height:Math.max(80,d.h*p-48),"onUpdate:modelValue":n=>{u(e.id,"freq1",n.bands[0].frequency),u(e.id,"gain1",n.bands[0].gain),u(e.id,"q1",n.bands[0].q),u(e.id,"freq2",n.bands[1].frequency),u(e.id,"gain2",n.bands[1].gain),u(e.id,"q2",n.bands[1].q),u(e.id,"freq3",n.bands[2].frequency),u(e.id,"gain3",n.bands[2].gain),u(e.id,"q3",n.bands[2].q)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):r==="wavetable"?(c(),T(Xe,{key:8,"model-value":{samples:i(e.id,"waveform",[]).length>0?i(e.id,"waveform",[]):Array.from({length:64},(n,v)=>Math.sin(v/64*Math.PI*2)),preset:i(e.id,"preset","sine")},"accent-color":h,width:Math.max(120,d.w*p-32),height:Math.max(60,d.h*p-48),"onUpdate:modelValue":n=>{u(e.id,"waveform",n.samples),u(e.id,"preset",n.preset)}},null,8,["model-value","accent-color","width","height","onUpdate:modelValue"])):r==="monitor"?(c(),f("div",et,b(ve(e.id)),1)):r==="oscilloscope"?(c(),f("canvas",{key:10,ref_for:!0,ref:n=>he(e.id,n),class:"scope-canvas",width:Math.max(100,d.w*p-32),height:Math.max(60,d.h*p-48)},null,8,tt)):C("",!0)],32),H.value&&!x&&r!=="slider"?(c(),f("div",at,b(de(e.id)),1)):C("",!0),g.value?(c(),f("div",{key:2,class:"resize-handle",onMousedown:$(n=>pe(n,e.id,d),["stop"])},null,40,ot)):C("",!0)],46,$e)}),128))],4),L.value.length===0?(c(),f("div",nt,[E(S(Ce),{size:48,class:"empty-icon"}),t[8]||(t[8]=s("h2",null,"No Controls in Flow",-1)),t[9]||(t[9]=s("p",null,"Add control nodes to your flow:",-1)),t[10]||(t[10]=s("ul",null,[s("li",null,"Slider, Knob, Trigger, XY Pad"),s("li",null,"Constant, LFO"),s("li",null,"Monitor, Oscilloscope")],-1)),s("button",{class:"back-btn",onClick:ee}," Go to Editor ")])):C("",!0)],2),s("footer",lt,[s("div",st,[H.value?(c(),f("button",{key:1,class:"stop-btn",onClick:t[5]||(t[5]=e=>S(w).stop())}," STOP ")):(c(),f("button",{key:0,class:"play-btn",onClick:t[4]||(t[4]=e=>S(w).start())}," PLAY ")),s("span",it,b(S(w).fps)+" FPS",1)]),s("div",ut,[s("span",null,b(L.value.length)+" controls",1)])])])}}}),ft=Le(rt,[["__scopeId","data-v-45b6b76e"]]);export{ft as default};
