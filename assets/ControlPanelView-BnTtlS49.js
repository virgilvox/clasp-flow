import{c as X,d as ut,ak as rt,a1 as ct,Z as dt,Y as pt,r as V,k as P,w as vt,A as ft,G as yt,s as ht,a as u,b as a,f as M,K as _,j as k,p as z,t as Y,V as gt,am as mt,n as R,F as q,E as xt,an as T,o as i,h as _t,U as kt,a5 as wt,a4 as O,$ as Mt}from"./index-CbF9oY04.js";import{V as bt,A as St,M as Ct}from"./video-DtRKO9PM.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=X("EyeIcon",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=X("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=X("HashIcon",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=X("WavesIcon",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Et={class:"control-panel-view"},zt={class:"control-panel-header"},Yt={class:"header-left"},Xt={key:0,class:"running-indicator"},Nt={class:"header-right"},At={key:0,class:"grid-lines"},Pt=["onMousedown"],Rt={class:"card-header"},Tt=["value","onInput"],Dt={key:1,class:"card-label"},$t={key:2,class:"live-value"},Bt={class:"card-body"},Ht=["value","onInput"],Wt={class:"value-display"},jt=["onMousedown","onMouseup","onMouseleave"],Gt=["onMousedown"],Ut=["value","onInput"],qt={key:4,class:"lfo-controls"},Ot={class:"lfo-row"},Zt=["value","onInput"],Kt={class:"lfo-row"},Jt=["value","onInput"],Qt={key:5,class:"monitor-display"},te=["onMousedown"],ee={key:0,class:"empty-state"},ne={class:"control-panel-footer"},oe={class:"playback-controls"},se={class:"fps-display"},ae={class:"flow-info"},D=12,f=60,Z=128,le=ut({__name:"ControlPanelView",setup(ie){const F=rt(),b=ct(),K=dt(),c=pt(),J=["slider","trigger","xy-pad","constant","lfo"],$=["monitor","oscilloscope","main-output"],d=V(!1),y=V(null),h=V(null),C=P(()=>b.activeFlow?b.activeFlow.nodes.filter(n=>{var o;const e=(o=n.data)==null?void 0:o.nodeType;return J.includes(e)||$.includes(e)}).map(n=>{var l,r;const e=(l=n.data)==null?void 0:l.nodeType,o=K.getDefinition(e),t=F.getControlLayout(n.id);return{node:n,nodeType:e,definition:o,label:((r=n.data)==null?void 0:r.label)||(o==null?void 0:o.name)||e,layout:t,isMonitor:$.includes(e)}}):[]),Q=P(()=>{if(C.value.length===0)return 400;const n=Math.max(...C.value.map(e=>e.layout.y+e.layout.h));return Math.max(400,(n+2)*f)});function tt(n){switch(n){case"slider":return T;case"trigger":return O;case"xy-pad":return Ct;case"constant":return It;case"lfo":return Lt;case"monitor":return Vt;case"oscilloscope":return St;case"main-output":return bt;default:return T}}function m(n,e,o=0){var l;const t=(l=b.activeFlow)==null?void 0:l.nodes.find(r=>r.id===n);return t!=null&&t.data?t.data[e]??o:o}function g(n,e,o){b.updateNodeData(n,{[e]:o})}function et(n){const e=c.nodeMetrics.get(n);if(!(e!=null&&e.outputValues))return"";const o=e.outputValues.value??e.outputValues.result??e.outputValues.trigger;return o==null?"":typeof o=="number"?o.toFixed(3):typeof o=="boolean"?o?"1":"0":String(o)}function nt(n){const e=c.nodeMetrics.get(n);if(!(e!=null&&e.outputValues))return"—";const o=e.outputValues.display??e.outputValues.value;return o==null?"—":typeof o=="number"?o.toFixed(4):typeof o=="boolean"?o?"TRUE":"FALSE":String(o)}function ot(n,e){b.updateNodeData(n,{label:e})}function st(n,e,o){d.value&&(n.preventDefault(),y.value={nodeId:e,startX:o.x,startY:o.y,offsetX:n.clientX,offsetY:n.clientY})}function B(n){if(y.value){const e=Math.round((n.clientX-y.value.offsetX)/f),o=Math.round((n.clientY-y.value.offsetY)/f),t=Math.max(0,Math.min(D-1,y.value.startX+e)),l=Math.max(0,y.value.startY+o);F.updateControlLayout(y.value.nodeId,{x:t,y:l})}if(h.value){const e=Math.round((n.clientX-h.value.startX)/f),o=Math.round((n.clientY-h.value.startY)/f),t=Math.max(2,Math.min(D,h.value.startW+e)),l=Math.max(2,h.value.startH+o);F.updateControlLayout(h.value.nodeId,{w:t,h:l})}}function H(){y.value=null,h.value=null}function at(n,e,o){d.value&&(n.preventDefault(),n.stopPropagation(),h.value={nodeId:e,startW:o.w,startH:o.h,startX:n.clientX,startY:n.clientY})}function W(){F.setViewMode("editor")}const N=P(()=>c.isRunning),A=V(new Map),I=V(new Map);let S=null;function lt(n,e){e?(A.value.set(n,e),I.value.has(n)||I.value.set(n,[])):A.value.delete(n)}function j(){var n;for(const[e,o]of A.value){const t=o.getContext("2d");if(!t)continue;const l=o.width,r=o.height;t.fillStyle="#0a0a0a",t.fillRect(0,0,l,r),t.strokeStyle="#1a3a1a",t.lineWidth=1,t.beginPath(),t.moveTo(0,r/2),t.lineTo(l,r/2),t.stroke();for(let x=0;x<4;x++){const s=l/4*x;t.beginPath(),t.moveTo(s,0),t.lineTo(s,r),t.stroke()}const p=c.nodeMetrics.get(e),L=((n=p==null?void 0:p.outputValues)==null?void 0:n._input_signal)??0;let v=I.value.get(e)??[];if(v.push(L),v.length>Z&&v.shift(),I.value.set(e,v),v.length>1){t.strokeStyle="#22c55e",t.lineWidth=2,t.beginPath();const x=l/Z;for(let s=0;s<v.length;s++){const w=s*x,E=r/2-v[s]*(r/2-4);s===0?t.moveTo(w,E):t.lineTo(w,E)}t.stroke(),t.shadowColor="#22c55e",t.shadowBlur=3,t.stroke(),t.shadowBlur=0}t.fillStyle="#22c55e",t.font="10px monospace",t.fillText(`${L.toFixed(3)}`,4,12)}c.isRunning&&(S=requestAnimationFrame(j))}function G(){S===null&&c.isRunning&&(S=requestAnimationFrame(j))}function U(){S!==null&&(cancelAnimationFrame(S),S=null)}return vt(()=>c.isRunning,n=>{n?G():U()},{immediate:!0}),ft(()=>{window.addEventListener("mousemove",B),window.addEventListener("mouseup",H),c.isRunning&&yt(()=>G())}),ht(()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",H),U()}),(n,e)=>{var o;return i(),u("div",Et,[a("header",zt,[a("div",Yt,[a("h1",null,_(((o=k(b).activeFlow)==null?void 0:o.name)??"Control Panel"),1),N.value?(i(),u("span",Xt,"LIVE")):M("",!0)]),a("div",Nt,[a("button",{class:z(["edit-mode-btn",{active:d.value}]),onClick:e[0]||(e[0]=t=>d.value=!d.value)},[Y(k(mt),{size:16}),gt(" "+_(d.value?"Done":"Edit Layout"),1)],2),a("button",{class:"back-btn",onClick:W}," Back to Editor ")])]),a("main",{class:z(["control-panel-content",{"edit-mode":d.value}])},[a("div",{class:"control-grid",style:R({"--grid-cols":D,"--cell-size":f+"px",minHeight:Q.value+"px"})},[d.value?(i(),u("div",At)):M("",!0),(i(!0),u(q,null,xt(C.value,({node:t,nodeType:l,label:r,layout:p,isMonitor:L})=>{var v,x;return i(),u("div",{key:t.id,class:z(["control-card",[l,{dragging:((v=y.value)==null?void 0:v.nodeId)===t.id,resizing:((x=h.value)==null?void 0:x.nodeId)===t.id}]]),style:R({left:p.x*f+"px",top:p.y*f+"px",width:p.w*f-8+"px",height:p.h*f-8+"px"})},[d.value?(i(),u("div",{key:0,class:"drag-handle",onMousedown:s=>st(s,t.id,p)},[Y(k(Ft),{size:16})],40,Pt)):M("",!0),a("div",Rt,[(i(),_t(kt(tt(l)),{size:14,class:"card-icon"})),d.value?(i(),u("input",{key:0,type:"text",class:"label-input",value:r,onInput:s=>ot(t.id,s.target.value),onMousedown:e[1]||(e[1]=wt(()=>{},["stop"]))},null,40,Tt)):(i(),u("span",Dt,_(r),1)),N.value&&!L?(i(),u("span",$t,_(et(t.id)),1)):M("",!0)]),a("div",Bt,[l==="slider"?(i(),u(q,{key:0},[a("input",{type:"range",class:"big-slider",value:m(t.id,"value",.5),min:"0",max:"1",step:"0.01",onInput:s=>g(t.id,"value",parseFloat(s.target.value))},null,40,Ht),a("div",Wt,_(m(t.id,"value",.5).toFixed(2)),1)],64)):l==="trigger"?(i(),u("button",{key:1,class:z(["trigger-btn",{active:m(t.id,"value",!1)}]),onMousedown:s=>g(t.id,"value",!0),onMouseup:s=>g(t.id,"value",!1),onMouseleave:s=>g(t.id,"value",!1)},[Y(k(O),{size:32})],42,jt)):l==="xy-pad"?(i(),u("div",{key:2,class:"xy-pad",onMousedown:s=>{const w=s.currentTarget.getBoundingClientRect(),E=Math.max(0,Math.min(1,(s.clientX-w.left)/w.width)),it=Math.max(0,Math.min(1,1-(s.clientY-w.top)/w.height));g(t.id,"x",E),g(t.id,"y",it)}},[a("div",{class:"xy-cursor",style:R({left:`${m(t.id,"x",.5)*100}%`,bottom:`${m(t.id,"y",.5)*100}%`})},null,4)],40,Gt)):l==="constant"?(i(),u("input",{key:3,type:"number",class:"big-number",value:m(t.id,"value",0),step:"0.1",onInput:s=>g(t.id,"value",parseFloat(s.target.value)||0)},null,40,Ut)):l==="lfo"?(i(),u("div",qt,[a("div",Ot,[e[4]||(e[4]=a("span",null,"F",-1)),a("input",{type:"range",value:m(t.id,"frequency",1),min:"0.01",max:"10",step:"0.01",onInput:s=>g(t.id,"frequency",parseFloat(s.target.value))},null,40,Zt)]),a("div",Kt,[e[5]||(e[5]=a("span",null,"A",-1)),a("input",{type:"range",value:m(t.id,"amplitude",1),min:"0",max:"2",step:"0.01",onInput:s=>g(t.id,"amplitude",parseFloat(s.target.value))},null,40,Jt)])])):l==="monitor"?(i(),u("div",Qt,_(nt(t.id)),1)):l==="oscilloscope"?(i(),u("canvas",{key:6,ref_for:!0,ref:s=>lt(t.id,s),class:"scope-canvas",width:"200",height:"100"},null,512)):M("",!0)]),d.value?(i(),u("div",{key:1,class:"resize-handle",onMousedown:s=>at(s,t.id,p)},null,40,te)):M("",!0)],6)}),128))],4),C.value.length===0?(i(),u("div",ee,[Y(k(T),{size:48,class:"empty-icon"}),e[6]||(e[6]=a("h2",null,"No Controls in Flow",-1)),e[7]||(e[7]=a("p",null,"Add control nodes to your flow:",-1)),e[8]||(e[8]=a("ul",null,[a("li",null,"Slider, Trigger, XY Pad"),a("li",null,"Constant, LFO"),a("li",null,"Monitor, Oscilloscope")],-1)),a("button",{class:"back-btn",onClick:W}," Go to Editor ")])):M("",!0)],2),a("footer",ne,[a("div",oe,[N.value?(i(),u("button",{key:1,class:"stop-btn",onClick:e[3]||(e[3]=t=>k(c).stop())}," ⏹ Stop ")):(i(),u("button",{key:0,class:"play-btn",onClick:e[2]||(e[2]=t=>k(c).start())}," ▶ Play ")),a("span",se,_(k(c).fps)+" FPS",1)]),a("div",ae,[a("span",null,_(C.value.length)+" controls",1)])])])}}}),ce=Mt(le,[["__scopeId","data-v-01a54137"]]);export{ce as default};
